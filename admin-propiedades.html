<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Propiedades - Nexxos Admin</title>
    <link rel="icon" href="Logo_MG.jpeg" type="image/jpeg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/admin-sidebar.css">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Open Sans', sans-serif;
            font-size: 0.85rem;
            color: #555;
        }

        /* --- NAVBAR styles removed (used sidebar) --- */

        /* --- ENCABEZADO --- */
        .page-header {
            background-color: #fff;
            padding: 15px 30px;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
        }

        .page-title {
            font-size: 1.6rem;
            color: #6c757d;
            margin: 0;
            font-weight: 300;
        }

        .breadcrumb {
            font-size: 0.8rem;
            color: #adb5bd;
            margin: 0;
        }

        /* --- BARRA DE FILTROS --- */
        .filters-container {
            background-color: #fff;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .count-text {
            color: #198754;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .active-filter {
            color: #dc3545;
            font-size: 0.8rem;
            cursor: pointer;
        }

        /* Botones de Vista (Verdes y Grises) */
        .btn-view {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            margin-right: 2px;
        }

        .btn-view:hover {
            background-color: #218838;
            color: white;
        }

        .btn-view-gray {
            background-color: #e2e6ea;
            color: #555;
            border: 1px solid #ced4da;
            padding: 4px 8px;
        }

        .btn-filter-main {
            background-color: #6c757d;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 6px 15px;
            border-radius: 20px;
            /* Redondeado como en la foto */
            border: none;
        }

        /* --- TABLA --- */
        .table-container {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            overflow-x: auto;
        }

        .table-nexxos {
            margin-bottom: 0;
        }

        .table-nexxos thead th {
            background-color: #fff;
            border-bottom: 2px solid #dee2e6;
            color: #333;
            font-weight: 700;
            font-size: 0.8rem;
            padding: 12px;
            vertical-align: middle;
        }

        .table-nexxos tbody td {
            padding: 12px;
            vertical-align: top;
            border-bottom: 1px solid #f2f2f2;
            font-size: 0.8rem;
        }

        .table-nexxos tbody tr:hover {
            background-color: #f8f9fa;
        }

        /* Columnas ordenables */
        th.sortable {
            cursor: pointer;
        }

        th.sortable::after {
            content: ' \25BE';
            color: #ccc;
            font-size: 0.7rem;
            float: right;
        }

        /* Miniaturas */
        .img-wrapper {
            width: 100px;
            height: 75px;
            background-color: #eee;
            position: relative;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .img-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .check-select {
            margin-top: 5px;
            color: #0d6efd;
            font-size: 0.75rem;
            cursor: pointer;
        }

        /* Badges (Etiquetas) */
        .badge-custom {
            padding: 4px 8px;
            border-radius: 3px;
            color: white;
            font-weight: 600;
            font-size: 0.7rem;
            display: inline-block;
            text-align: center;
            min-width: 60px;
        }

        .bg-blue {
            background-color: #007bff;
        }

        /* Venta */
        .bg-cyan {
            background-color: #17a2b8;
        }

        /* Arriendo */
        .bg-green {
            background-color: #28a745;
        }

        /* Activa */
        .bg-gray {
            background-color: #6c757d;
        }

        /* Borrador */

        /* Acciones */
        .btn-action-row {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .btn-table {
            background: #fff;
            border: 1px solid #ccc;
            color: #555;
            font-size: 0.75rem;
            padding: 2px 8px;
            text-align: left;
            border-radius: 3px;
        }

        .btn-table i {
            margin-right: 5px;
        }

        .btn-table.ficha i {
            color: #28a745;
        }

        .btn-table.share i {
            color: #dc3545;
        }

        /* Paginación */
        .pagination-bar {
            padding: 10px 15px;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: flex-end;
        }

        .page-link {
            color: #007bff;
            font-size: 0.8rem;
        }

        .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }

        /* --- ESTILOS MENÚ FLOTANTE (COMPARTIR) --- */
        .share-menu {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 8px 0;
            z-index: 9999;
            /* Muy alto para que flote sobre todo */
            display: none;
            /* Oculto por defecto */
            min-width: 180px;
        }

        .share-menu.show {
            display: block;
            /* Se muestra al agregar la clase 'show' */
            animation: fadeIn 0.2s ease-in-out;
        }

        .share-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            color: #555;
            text-decoration: none;
            font-size: 0.85rem;
            transition: background 0.2s;
        }

        .share-item:hover {
            background-color: #f8f9fa;
            color: #0d6efd;
        }

        .share-item i {
            font-size: 1.1rem;
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        /* Colores de Marca */
        .share-item.whatsapp i {
            color: #25D366;
        }

        .share-item.facebook i {
            color: #1877F2;
        }

        /* Color para el botón de Twitter/X */
        .share-item.twitter i {
            color: #000;
            /* Negro oficial de X */
        }

        .share-item.copy i {
            color: #6c757d;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- ESTILOS MODAL FICHA TIPO NEXXOS --- */
        .modal-nexxos .modal-header {
            background-color: #2c3e50;
            /* Azul oscuro Nexxos */
            color: white;
            border-bottom: none;
            padding: 15px 20px;
        }

        .modal-nexxos .modal-title {
            font-weight: 600;
            font-size: 1.1rem;
            text-transform: uppercase;
        }

        .modal-nexxos .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
            /* Equis blanca */
        }

        /* Pestañas Superiores */
        .nav-tabs-nexxos {
            border-bottom: 1px solid #dee2e6;
            background-color: #f8f9fa;
            padding: 10px 20px 0;
            gap: 5px;
            display: flex;
        }

        .nav-tabs-nexxos .nav-link {
            border: 1px solid transparent;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            color: #6c757d;
            background: transparent;
            font-weight: 600;
            font-size: 0.9rem;
            padding: 8px 15px;
            cursor: pointer;
        }

        .nav-tabs-nexxos .nav-link.active {
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
            color: #343a40;
            border-top: 3px solid #2c3e50;
            /* Línea azul arriba */
        }

        .nav-tabs-nexxos .nav-link i {
            margin-right: 5px;
        }

        /* Contenido del Modal */
        .ficha-content {
            padding: 20px;
            background-color: #fff;
            min-height: 400px;
        }

        /* Caja de Precio */
        .price-box {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
        }

        .price-box .tag {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .price-box .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #0d6efd;
            /* Azul precio */
        }

        .price-box .value-clp {
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* Info Grid */
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        .info-row label {
            font-weight: 600;
            color: #333;
        }

        /* Galería */
        .gallery-placeholder {
            background-color: #eee;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .gallery-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Botón Seleccionar (Naranja) */
        .btn-select-orange {
            background-color: #f39c12;
            /* Naranja Nexxos */
            border: none;
            color: white;
            font-weight: 600;
            padding: 10px 30px;
        }

        .btn-select-orange:hover {
            background-color: #e67e22;
            color: white;
        }
    </style>
</head>

<body>

    <div class="sidebar"></div>

    <div class="main-content">
        <!-- User info that was in navbar, maybe move it here or just drop it for now as per standardization request? 
             matches admin-dashboard layout which has no top user bar in main-content usually, 
             or maybe I should keep it. admin-dashboard does not seem to have a top bar in the provided view.
             I will just drop the navbar specific user info for standardization unless I see it in dashboard.
        -->

        <div class="page-header">
            <h2 class="page-title">Propiedades</h2>
            <div class="breadcrumb">Panel de Control • Propiedades</div>
        </div>

        <div class="container-fluid px-4">

            <div class="filters-container">
                <div>
                    <span class="count-text" id="totalProps">Cargando...</span> <span
                        class="text-muted small">encontradas</span>
                    <div class="mt-1">
                        <small class="text-muted">Estado:</small> <span class="active-filter">Activa <i
                                class="bi bi-x"></i></span>
                    </div>
                </div>

                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-view rounded"><i class="bi bi-arrow-down-up"></i></button>
                    <button class="btn btn-view rounded"><i class="bi bi-layout-split"></i></button>
                    <button class="btn btn-view rounded"><i class="bi bi-layout-three-columns"></i></button>

                    <div class="vr mx-2"></div>

                    <button class="btn btn-view-gray rounded"><i class="bi bi-list-ul"></i></button>
                    <button class="btn btn-view-gray rounded"><i class="bi bi-grid-3x3-gap"></i></button>
                    <button class="btn btn-view-gray rounded"><i class="bi bi-geo-alt"></i></button>

                    <button class="btn btn-filter-main ms-3">FILTRAR LISTADO <i class="bi bi-funnel-fill"></i></button>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4">
                    <div class="input-group">
                        <input type="text" class="form-control form-control-sm" placeholder="buscar...">
                        <button class="btn btn-warning text-white btn-sm"><i class="bi bi-search"></i></button>
                    </div>
                </div>
                <div class="col-md-8 d-flex justify-content-end">
                    <nav>
                        <ul class="pagination pagination-sm mb-0" id="paginacionTop"></ul>
                    </nav>
                </div>
            </div>

            <div class="table-container table-responsive">
                <table class="table table-nexxos">
                    <thead>
                        <tr>
                            <th width="120">Imagen</th>
                            <th class="sortable">Código</th>
                            <th class="sortable">Tipo</th>
                            <th class="sortable">Operación</th>
                            <th class="sortable">Estado</th>
                            <th class="sortable">Captador</th>
                            <th class="sortable">Dirección</th>
                            <th class="sortable">Precio</th>
                            <th class="sortable">Comuna</th>
                            <th class="sortable">Región</th>
                            <th>Editar</th>
                        </tr>
                    </thead>
                    <tbody id="tablaCuerpo">
                        <tr>
                            <td colspan="11" class="text-center py-5">
                                <div class="spinner-border text-primary mb-2"></div>
                                <p class="text-muted">Conectando con base de datos...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="pagination-bar">
                    <nav>
                        <ul class="pagination pagination-sm mb-0" id="paginacionBottom"></ul>
                    </nav>
                </div>
            </div>

            <div class="text-center mt-4 mb-5 small text-muted">
                2026 © Convecta. Todos los derechos reservados.
            </div>
        </div>
    </div><!-- End main-content -->
    <div id="shareMenu" class="share-menu">
        <a href="#" class="share-item whatsapp" onclick="compartirRed('whatsapp')">
            <i class="bi bi-whatsapp"></i> WhatsApp
        </a>
        <a href="#" class="share-item facebook" onclick="compartirRed('facebook')">
            <i class="bi bi-facebook"></i> Facebook
        </a>
        <a href="#" class="share-item twitter" onclick="compartirRed('twitter')">
            <i class="bi bi-twitter-x"></i> X
        </a>
        <hr class="my-1">
        <a href="#" class="share-item copy" onclick="compartirRed('copy')">
            <i class="bi bi-link-45deg"></i> Copiar Enlace
        </a>
    </div>

    <div class="modal fade modal-nexxos" id="modalFicha" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">FICHA PROPIEDAD</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="nav-tabs-nexxos">
                    <button class="nav-link active" onclick="switchTab('propiedad')"><i
                            class="bi bi-house-door-fill"></i> Propiedad</button>
                    <button class="nav-link" onclick="switchTab('reportes')"><i class="bi bi-graph-up"></i>
                        Reportes</button>
                    <button class="nav-link" onclick="switchTab('interesados')"><i class="bi bi-people-fill"></i>
                        Interesados</button>
                    <button class="nav-link" onclick="switchTab('bitacora')"><i class="bi bi-chat-left-text-fill"></i>
                        Bitácora</button>
                    <button class="nav-link" onclick="switchTab('portales')"><i class="bi bi-laptop"></i>
                        Portales</button>
                    <button class="nav-link" onclick="switchTab('tareas')"><i class="bi bi-bell-fill"></i>
                        Tareas</button>
                </div>

                <div class="modal-body p-0" style="background-color: #f8f9fa;">

                    <div id="tab-propiedad" class="ficha-content">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="gallery-placeholder position-relative bg-dark rounded overflow-hidden"
                                    style="height: 320px;">
                                    <img id="modalImg" src="" alt="Propiedad" class="w-100 h-100"
                                        style="object-fit: cover;">
                                    <div
                                        class="position-absolute top-50 start-0 translate-middle-y w-100 d-flex justify-content-between px-2">
                                        <button class="btn btn-light btn-sm rounded-circle opacity-75"><i
                                                class="bi bi-chevron-left"></i></button>
                                        <button class="btn btn-light btn-sm rounded-circle opacity-75"><i
                                                class="bi bi-chevron-right"></i></button>
                                    </div>
                                    <div class="position-absolute bottom-0 w-100 p-2 text-center">
                                        <i class="bi bi-circle-fill text-white small mx-1"></i>
                                        <i class="bi bi-circle text-white-50 small mx-1"></i>
                                        <i class="bi bi-circle text-white-50 small mx-1"></i>
                                    </div>
                                </div>
                                <div class="mt-3 d-flex gap-2 justify-content-center">
                                    <button class="btn btn-outline-primary btn-sm rounded-circle"
                                        title="Compartir Facebook"><i class="bi bi-facebook"></i></button>
                                    <button class="btn btn-outline-success btn-sm rounded-circle"
                                        title="Compartir WhatsApp"><i class="bi bi-whatsapp"></i></button>
                                    <button class="btn btn-outline-secondary btn-sm rounded-circle"
                                        title="Copiar Enlace"><i class="bi bi-link-45deg"></i></button>
                                </div>

                                <div class="mt-4 p-3 bg-white border rounded">
                                    <h6 class="text-primary fw-bold mb-2"><i class="bi bi-key-fill"></i> Forma de
                                        Visitar</h6>
                                    <div class="fw-bold text-dark fs-5">+56 9 5228 6689</div>
                                    <small class="text-muted">Coordinar con captador</small>
                                </div>
                            </div>

                            <div class="col-md-7">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <div class="text-primary fw-bold" id="modalCodigo">Cód: 000</div>
                                        <h4 class="fw-bold mb-0" id="modalTipo">Casa</h4>
                                        <div class="text-muted small text-uppercase" id="modalDireccionCorta">CALLE
                                            NUEVA</div>
                                    </div>
                                    <span class="badge bg-success" id="modalEstadoBadge">PUBLICADA</span>
                                </div>

                                <p class="text-muted small mt-1 mb-3">
                                    <i class="bi bi-geo-alt"></i> <span id="modalDireccionLarga">Dirección
                                        completa...</span><br>
                                    Rol: <span id="modalRol">0000-000</span>
                                </p>

                                <div class="price-box d-flex justify-content-between align-items-center px-4 py-3 mb-3">
                                    <div class="text-start">
                                        <span class="tag d-block mb-1" id="modalTagOperacion">VENTA</span>
                                        <div class="value" id="modalPrecio">UF 0.000</div>
                                        <div class="value-clp text-muted" id="modalPrecioPesos">$ 0</div>
                                    </div>
                                </div>

                                <div class="row g-2 text-center mb-3">
                                    <div class="col-4">
                                        <div class="bg-white border rounded p-2">
                                            <small class="d-block text-muted">Dormitorios</small>
                                            <strong id="modalDorms">0</strong>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="bg-white border rounded p-2">
                                            <small class="d-block text-muted">Baños</small>
                                            <strong id="modalBanos">0</strong>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="bg-white border rounded p-2">
                                            <small class="d-block text-muted">Contribuciones</small>
                                            <strong id="modalContrib">$ 194.388</strong>
                                        </div>
                                    </div>
                                </div>

                                <div class="card bg-white border mb-3">
                                    <div class="card-header bg-white fw-bold py-2">Descripción</div>
                                    <div class="card-body py-2">
                                        <p class="small text-muted mb-0" id="modalDesc"
                                            style="max-height: 120px; overflow-y: auto;">
                                            Cargando descripción...
                                        </p>
                                    </div>
                                </div>

                                <div class="bg-white border rounded p-3 small">
                                    <h6 class="fw-bold mb-3 border-bottom pb-2">Características</h6>
                                    <div class="row g-2">
                                        <div class="col-6 d-flex justify-content-between border-bottom pb-1">
                                            <span class="text-muted">Sup. Terreno:</span> <strong id="modalSupTerreno">0
                                                m²</strong>
                                        </div>
                                        <div class="col-6 d-flex justify-content-between border-bottom pb-1">
                                            <span class="text-muted">Sup. Construida:</span> <strong
                                                id="modalSupConst">0 m²</strong>
                                        </div>
                                        <div class="col-6 d-flex justify-content-between border-bottom pb-1">
                                            <span class="text-muted">Estacionamientos:</span> <strong
                                                id="modalEstac">0</strong>
                                        </div>
                                        <div class="col-6 d-flex justify-content-between border-bottom pb-1">
                                            <span class="text-muted">Canje:</span> <strong class="text-success"><i
                                                    class="bi bi-check"></i> Sí</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-reportes" class="ficha-content" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="fw-bold m-0"><i class="bi bi-graph-up"></i> Reporte de Gestión</h5>
                            <select class="form-select form-select-sm w-auto">
                                <option>Últimos 3 Meses</option>
                                <option>Último Mes</option>
                                <option>Histórico</option>
                            </select>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="card h-100 border shadow-sm">
                                    <div class="card-header bg-white fw-bold text-primary">Contactos</div>
                                    <div class="card-body text-center d-flex flex-column justify-content-center py-5">
                                        <i class="bi bi-people display-4 text-muted opacity-25 mb-3"></i>
                                        <h3 class="fw-bold text-dark">0</h3>
                                        <small class="text-muted">Total contactos del período</small>
                                    </div>
                                    <div class="card-footer bg-light small text-muted">
                                        Por origen: Sin datos
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card h-100 border shadow-sm">
                                    <div class="card-header bg-white fw-bold text-success">Órdenes de Visita</div>
                                    <div class="card-body text-center d-flex flex-column justify-content-center py-5">
                                        <i class="bi bi-geo-alt display-4 text-muted opacity-25 mb-3"></i>
                                        <h3 class="fw-bold text-dark">0</h3>
                                        <small class="text-muted">Total O.V. del período</small>
                                    </div>
                                    <div class="card-footer bg-light small text-muted">
                                        Realizadas: 0 | Canceladas: 0
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="card h-100 border shadow-sm">
                                    <div class="card-header bg-white fw-bold text-info">Envíos</div>
                                    <div class="card-body text-center d-flex flex-column justify-content-center py-5">
                                        <i class="bi bi-envelope display-4 text-muted opacity-25 mb-3"></i>
                                        <h3 class="fw-bold text-dark">0</h3>
                                        <small class="text-muted">Total envíos del período</small>
                                    </div>
                                    <div class="card-footer bg-light small text-muted">
                                        Último informe: Sin envíos
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 p-3 bg-white border rounded">
                            <h6 class="fw-bold border-bottom pb-2">Información de Ciclo de Vida</h6>
                            <div class="row small text-muted">
                                <div class="col-md-4">
                                    <strong>Última actualización:</strong> 10/02/2026 por Marlen Teresita
                                </div>
                                <div class="col-md-4">
                                    <strong>Días activa:</strong> 0 días
                                </div>
                                <div class="col-md-4">
                                    <strong>Días sin acciones:</strong> 0 días
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-interesados" class="ficha-content text-center py-5" style="display: none;">
                        <i class="bi bi-person-x display-1 text-muted opacity-25"></i>
                        <h5 class="mt-3 text-muted">No se encuentran perfiles de búsqueda coincidentes</h5>
                        <p class="text-muted small">Aquí aparecerán los clientes cuyos requerimientos coincidan con esta
                            propiedad.</p>
                        <button class="btn btn-primary btn-sm mt-2"><i class="bi bi-plus-circle"></i> Agregar Interesado
                            Manual</button>
                    </div>

                    <div id="tab-bitacora" class="ficha-content" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="fw-bold m-0"><i class="bi bi-clock-history"></i> Historial de Actividad</h5>
                            <button class="btn btn-dark btn-sm"><i class="bi bi-plus-lg"></i> Agregar
                                comentario</button>
                        </div>

                        <div class="timeline p-3 bg-white border rounded">
                            <div class="d-flex gap-3 mb-3 pb-3 border-bottom">
                                <div class="flex-shrink-0">
                                    <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center"
                                        style="width: 40px; height: 40px;">
                                        <i class="bi bi-person-fill"></i>
                                    </div>
                                </div>
                                <div>
                                    <div class="d-flex align-items-center gap-2">
                                        <strong class="text-dark">Marlen Teresita Guzman</strong>
                                        <span class="text-muted small">10/02/2026 15:53:22</span>
                                    </div>
                                    <p class="mb-0 text-secondary">Se agregó la propiedad al sistema.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-portales" class="ficha-content" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="fw-bold m-0">Estado en Portales</h5>
                            <a href="#" class="small text-primary text-decoration-none">Ver histórico</a>
                        </div>

                        <div class="list-group shadow-sm">

                            <div class="list-group-item d-flex justify-content-between align-items-center bg-light">
                                <div>
                                    <strong class="text-primary"><i class="bi bi-globe"></i> Sitio web propio</strong>
                                    <div class="small text-success fw-bold"><i class="bi bi-check-circle-fill"></i>
                                        Publicada</div>
                                    <small class="text-muted">Cód. Int: 101137173</small>
                                </div>
                                <a href="#" class="btn btn-outline-secondary btn-sm"><i
                                        class="bi bi-box-arrow-up-right"></i> Ver</a>
                            </div>

                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong><img src="https://www.portalinmobiliario.com/favicon.ico" width="16"
                                                class="me-1"> Portal Inmobiliario</strong>
                                        <div class="small text-success fw-bold"><i class="bi bi-check-circle-fill"></i>
                                            Publicada</div>
                                        <small class="text-muted d-block">Cód: MLC3575566670</small>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-secondary">Estándar</span>
                                        <small class="d-block text-muted mt-1">Expira: 10/03/2026</small>
                                    </div>
                                </div>
                            </div>

                            <div class="list-group-item">
                                <div>
                                    <strong>TocToc</strong>
                                    <div class="small text-warning fw-bold"><i class="bi bi-hourglass-split"></i>
                                        Pendiente</div>
                                </div>
                            </div>

                            <div class="list-group-item">
                                <div>
                                    <strong>Yapo.cl</strong>
                                    <div class="small text-success fw-bold"><i class="bi bi-check-circle-fill"></i>
                                        Publicada</div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div id="tab-tareas" class="ficha-content" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="fw-bold m-0">Tareas Pendientes</h5>
                            <button class="btn btn-dark btn-sm">Agregar tarea</button>
                        </div>

                        <div class="text-center py-5">
                            <img src="https://cdn-icons-png.flaticon.com/512/7486/7486744.png" width="80"
                                class="mb-3 opacity-50">
                            <h6 class="text-muted">No hay tareas registradas para esta propiedad</h6>
                            <p class="small text-muted">Crea recordatorios de llamadas, visitas o trámites aquí.</p>
                        </div>
                    </div>

                </div>

                <div class="modal-footer bg-dark border-0 justify-content-center">
                    <button type="button" class="btn btn-select-orange rounded-1">
                        <i class="bi bi-check2-square"></i> Seleccionar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // VARIABLE GLOBAL PARA GUARDAR LOS DATOS
        let listaPropiedadesGlobal = [];

        document.addEventListener('DOMContentLoaded', () => {
            cargarPropiedades(1);
        });

        async function cargarPropiedades(pagina) {
            try {
                const res = await fetch(`http://localhost:3000/api/propiedades-list?page=${pagina}&limit=15`);
                const data = await res.json();
                if (data.success) {
                    listaPropiedadesGlobal = data.data;
                    document.getElementById('totalProps').innerText = `${data.pagination.totalItems} PROPIEDADES`;
                    pintarTabla(data.data);
                    pintarPaginacion(data.pagination);
                } else { mostrarError(data.message); }
            } catch (error) { console.error(error); mostrarError("No se pudo conectar con el servidor."); }
        }

        // --- FUNCIÓN QUE ABRE LA FICHA (CON DATOS REALES) ---
        function verFicha(id) {
            const prop = listaPropiedadesGlobal.find(p => p.id === id);
            if (!prop) { alert("Error: No se encontraron datos."); return; }

            // 1. Llenar Datos Principales
            document.getElementById('modalCodigo').innerText = 'Cód: ' + prop.id;
            document.getElementById('modalTipo').innerText = prop.tipo_propiedad || 'Propiedad';
            document.getElementById('modalDireccionCorta').innerText = (prop.direccion_calle || 'Dirección') + ' ' + (prop.direccion_numero || '');
            document.getElementById('modalDireccionLarga').innerText = (prop.direccion_calle || '') + ' ' + (prop.direccion_numero || '') + ', ' + (prop.comuna || '') + ', ' + (prop.region || '');
            document.getElementById('modalRol').innerText = prop.rol_sii || 'Sin Rol';
            document.getElementById('modalEstadoBadge').innerText = prop.estado_publicacion || 'BORRADOR';
            document.getElementById('modalEstadoBadge').className = prop.estado_publicacion === 'PUBLICADA' ? 'badge bg-success' : 'badge bg-secondary';

            const imgUrl = prop.imagen_principal || 'https://placehold.co/600x400?text=Sin+Imagen';
            document.getElementById('modalImg').src = imgUrl;

            // Precio
            if (prop.operacion_venta) {
                document.getElementById('modalTagOperacion').innerText = 'VENTA';
                document.getElementById('modalTagOperacion').className = 'tag text-primary fw-bold';
                document.getElementById('modalPrecio').innerText = (prop.moneda_venta || 'UF') + ' ' + Number(prop.precio_venta).toLocaleString('es-CL');
                document.getElementById('modalPrecioPesos').innerText = '$ ' + (prop.precio_venta * 38000).toLocaleString('es-CL') + ' aprox';
            } else {
                document.getElementById('modalTagOperacion').innerText = 'ARRIENDO';
                document.getElementById('modalTagOperacion').className = 'tag text-success fw-bold';
                document.getElementById('modalPrecio').innerText = (prop.moneda_arriendo || '$') + ' ' + Number(prop.precio_arriendo).toLocaleString('es-CL');
                document.getElementById('modalPrecioPesos').innerText = '';
            }

            // Datos Técnicos
            document.getElementById('modalDorms').innerText = prop.dormitorios || 0;
            document.getElementById('modalBanos').innerText = prop.banos || 0;
            // Ojo: Contribuciones no siempre viene en la lista, si no viene poner 0
            document.getElementById('modalContrib').innerText = '$ ' + (prop.contribuciones || 0).toLocaleString('es-CL');
            document.getElementById('modalSupConst').innerText = (prop.superficie_util || 0) + ' m²';
            // Superficie total tampoco viene en lista simple a veces, usar lógica defensiva
            document.getElementById('modalSupTerreno').innerText = (prop.superficie_total || 0) + ' m²';
            document.getElementById('modalEstac').innerText = prop.estacionamientos || 0;

            // Descripción: Si es muy larga recortar o dejar scroll
            const desc = prop.detalles_json && JSON.parse(prop.detalles_json).descripcion_publica ? JSON.parse(prop.detalles_json).descripcion_publica : (prop.descripcion_publica || "Sin descripción.");
            document.getElementById('modalDesc').innerText = desc;

            // 2. DATOS REALES EN OTRAS PESTAÑAS

            // TAB REPORTES (Sin datos reales aún)
            // Se mantienen en 0 como se pidió ("ser sincero")

            // TAB BITÁCORA (Simulamos entrada de creación con datos reales)
            const captador = prop.captador_nombre || 'Marlen Teresita'; // Si no viene, fallback

            const bitacoraHtml = `
                <div class="d-flex gap-3 mb-3 pb-3 border-bottom">
                    <div class="flex-shrink-0">
                        <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center"
                            style="width: 40px; height: 40px;">
                            <i class="bi bi-person-fill"></i>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex align-items-center gap-2">
                            <strong class="text-dark">${captador}</strong>
                            <span class="text-muted small">Fecha Ingreso</span>
                        </div>
                        <p class="mb-0 text-secondary">Propiedad cargada al sistema.</p>
                    </div>
                </div>
            `;
            const timelineContainer = document.querySelector('#tab-bitacora .timeline');
            if (timelineContainer) timelineContainer.innerHTML = bitacoraHtml;


            // TAB PORTALES (Estado Real)
            const estadoWeb = prop.estado_publicacion === 'PUBLICADA';
            const iconWeb = estadoWeb ? '<i class="bi bi-check-circle-fill"></i> Publicada' : '<i class="bi bi-pause-circle-fill"></i> Borrador';
            const classWeb = estadoWeb ? 'text-success' : 'text-secondary';

            const listPortales = document.querySelector('#tab-portales .list-group');
            if (listPortales) {
                listPortales.innerHTML = `
                    <div class="list-group-item d-flex justify-content-between align-items-center bg-light">
                        <div>
                            <strong class="text-primary"><i class="bi bi-globe"></i> Sitio web propio</strong>
                            <div class="small ${classWeb} fw-bold">${iconWeb}</div>
                            <small class="text-muted">Cód. Int: ${prop.id}</small>
                        </div>
                        <a href="web-ficha.html?id=${prop.id}" target="_blank" class="btn btn-outline-secondary btn-sm"><i class="bi bi-box-arrow-up-right"></i> Ver</a>
                    </div>
                    <div class="list-group-item">
                        <div>
                            <strong>Portal Inmobiliario</strong>
                            <div class="small text-muted">No conectado</div>
                        </div>
                    </div>
                    <div class="list-group-item">
                        <div>
                            <strong>TocToc</strong>
                            <div class="small text-muted">No conectado</div>
                        </div>
                    </div>
                     <div class="list-group-item">
                        <div>
                            <strong>Yapo.cl</strong>
                            <div class="small text-muted">No conectado</div>
                        </div>
                    </div>
                 `;
            }

            // 3. RESETEAR PESTAÑAS MANUALMENTE
            const tabs = ['propiedad', 'reportes', 'interesados', 'bitacora', 'portales', 'tareas'];
            tabs.forEach(t => {
                const el = document.getElementById('tab-' + t);
                if (el) el.style.display = 'none';
            });
            // Mostramos la primera
            document.getElementById('tab-propiedad').style.display = 'block';

            // Reseteamos botones activos
            document.querySelectorAll('.nav-tabs-nexxos .nav-link').forEach(btn => btn.classList.remove('active'));
            // Activamos el primer botón (Propiedad)
            document.querySelector('.nav-tabs-nexxos .nav-link:first-child').classList.add('active');

            // 4. ABRIR MODAL
            const modalElement = document.getElementById('modalFicha');
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
        }

        // Función para cambiar pestañas dentro del modal (Visual)
        function switchTab(tabName) {
            // 1. Manejo visual de los botones (Pestañas)
            // Usamos 'event' solo si existe (click del usuario)
            if (window.event) {
                document.querySelectorAll('.nav-tabs-nexxos .nav-link').forEach(btn => btn.classList.remove('active'));
                window.event.currentTarget.classList.add('active');
            }

            // 2. Ocultar TODAS las pestañas primero
            const allTabs = ['propiedad', 'reportes', 'interesados', 'bitacora', 'portales', 'tareas'];

            allTabs.forEach(name => {
                const el = document.getElementById('tab-' + name);
                if (el) el.style.display = 'none';
            });

            // 3. Mostrar SOLO la seleccionada
            const target = document.getElementById('tab-' + tabName);
            if (target) {
                target.style.display = 'block';
            } else {
                console.error("No se encontró la pestaña: tab-" + tabName);
            }
        }

        // --- (Mantener funciones pintarTabla, pintarPaginacion, mostrarError, etc.) ---
        function pintarTabla(propiedades) {
            const tbody = document.getElementById('tablaCuerpo');
            tbody.innerHTML = '';

            if (propiedades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" class="text-center py-5 text-muted">No se encontraron propiedades.</td></tr>';
                return;
            }

            propiedades.forEach(prop => {
                let opHtml = '';
                if (prop.operacion_venta) opHtml += '<span class="badge-custom bg-blue mb-1">Venta</span><br>';
                if (prop.operacion_arriendo) opHtml += '<span class="badge-custom bg-cyan">Arriendo</span>';

                let estadoClass = prop.estado_publicacion === 'PUBLICADA' ? 'bg-green' : 'bg-gray';
                let estadoTxt = prop.estado_publicacion === 'PUBLICADA' ? 'Activa' : 'Borrador';

                let precioHtml = '';
                if (prop.precio_venta) {
                    precioHtml += `<div class="fw-bold text-dark">${prop.moneda_venta || 'UF'} ${Number(prop.precio_venta).toLocaleString('es-CL')}</div>`;
                }
                if (prop.precio_arriendo) {
                    precioHtml += `<div class="small text-muted">${prop.moneda_arriendo || '$'} ${Number(prop.precio_arriendo).toLocaleString('es-CL')}</div>`;
                }

                let img = prop.imagen_principal || "https://placehold.co/150?text=Casa";

                const row = `
                    <tr>
                        <td>
                            <div class="img-wrapper"><img src="${img}"></div>
                            <div class="check-select"><i class="bi bi-square"></i> Seleccionar</div>
                        </td>
                        <td class="fw-bold text-secondary">#${prop.id}</td>
                        <td>${prop.tipo_propiedad || '-'}</td>
                        <td>${opHtml}</td>
                        <td><span class="badge-custom ${estadoClass}">${estadoTxt}</span></td>
                        <td>Marlen Teresita</td>
                        <td>
                            <div class="fw-bold">${prop.direccion_calle || ''} ${prop.direccion_numero || ''}</div>
                            <small class="text-muted">${prop.sector || ''}</small>
                        </td>
                        <td>${precioHtml}</td>
                        <td>${prop.comuna || ''}</td>
                        <td>${prop.region || ''}</td>
                        <td>
                            <div class="btn-action-row">
                                <button class="btn-table ficha" onclick="verFicha(${prop.id})">
                                    <i class="bi bi-search"></i> Ficha
                                </button>
                                <button class="btn-table" onclick="location.href='admin-editar-propiedad.html?id=${prop.id}'" style="border-color: #0d6efd; color: #0d6efd;">
                                    <i class="bi bi-pencil"></i> Editar
                                </button>
                                <button class="btn-table share" onclick="toggleShare(event, ${prop.id})">
                                    <i class="bi bi-share"></i> Compartir
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function pintarPaginacion(pag) {
            const html = [];
            const prevDisabled = pag.page === 1 ? 'disabled' : '';
            const nextDisabled = pag.page === pag.totalPages ? 'disabled' : '';

            html.push(`<li class="page-item ${prevDisabled}"><a class="page-link" href="#" onclick="cargarPropiedades(${pag.page - 1})">«</a></li>`);

            for (let i = 1; i <= pag.totalPages; i++) {
                const active = i === pag.page ? 'active' : '';
                html.push(`<li class="page-item ${active}"><a class="page-link" href="#" onclick="cargarPropiedades(${i})">${i}</a></li>`);
            }

            html.push(`<li class="page-item ${nextDisabled}"><a class="page-link" href="#" onclick="cargarPropiedades(${pag.page + 1})">»</a></li>`);

            document.getElementById('paginacionTop').innerHTML = html.join('');
            document.getElementById('paginacionBottom').innerHTML = html.join('');
        }

        function mostrarError(msg) {
            document.getElementById('tablaCuerpo').innerHTML = `<tr><td colspan="11" class="text-center text-danger py-5"><i class="bi bi-exclamation-triangle-fill display-4"></i><br>${msg}</td></tr>`;
        }

        // LÓGICA DE COMPARTIR (IGUAL QUE ANTES)
        let currentShareId = null;
        function toggleShare(event, id) {
            event.stopPropagation();
            const menu = document.getElementById('shareMenu');
            if (currentShareId === id && menu.classList.contains('show')) {
                menu.classList.remove('show');
                currentShareId = null;
                return;
            }
            currentShareId = id;
            const rect = event.currentTarget.getBoundingClientRect();
            menu.style.top = (window.scrollY + rect.bottom + 5) + 'px';
            menu.style.left = (window.scrollX + rect.left - 50) + 'px';
            menu.classList.add('show');
        }

        function compartirRed(red) {
            if (!currentShareId) return;

            // 1. URL real pública de la propiedad
            const baseUrl = window.location.origin;
            const urlPropiedad = `${baseUrl}/web-ficha.html?id=${currentShareId}`;

            // Texto para acompañar
            const texto = `¡Mira esta propiedad en Marlen Guzmán! ID: #${currentShareId}`;

            let shareUrl = "";

            switch (red) {
                case 'whatsapp':
                    shareUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(texto + ' ' + urlPropiedad)}`;
                    break;

                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(urlPropiedad)}`;
                    break;

                // CAMBIO: Lógica para Twitter (X)
                case 'twitter':
                    // Twitter usa 'url' para el enlace y 'text' para el mensaje opcional
                    shareUrl = `https://x.com/intent/post?url=${encodeURIComponent(urlPropiedad)}&text=${encodeURIComponent(texto)}`;
                    break;

                case 'copy':
                    navigator.clipboard.writeText(urlPropiedad).then(() => { alert("✅ Enlace copiado al portapapeles"); });
                    document.getElementById('shareMenu').classList.remove('show');
                    return;
            }

            // Abrir ventana emergente
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }

            document.getElementById('shareMenu').classList.remove('show');
        }

        document.addEventListener('click', (e) => {
            const menu = document.getElementById('shareMenu');
            if (!menu.contains(e.target)) {
                menu.classList.remove('show');
                currentShareId = null;
            }
        });
    </script>



    <script src="admin-auth.js"></script>
    <script src="js/admin-sidebar.js"></script>
</body>

</html>